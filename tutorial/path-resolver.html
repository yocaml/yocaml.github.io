<!doctype html>
<html lang="en-US">
  <head>
    <title>YOCaml - Path resolver</title>
    <link rel="canonical" href="https://yocaml.github.io/tutorial/path-resolver.html" />
    <link rel="stylesheet" href="/assets/css/yocaml.css" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="YOCaml">
    <meta name="description" content="A module for solving paths">
    <meta name="creator" content="xvw">
    <meta property="og:site_name" content="YOCaml">
    <meta property="og:url" content="https://yocaml.github.io/tutorial/path-resolver.html">
    <meta property="og:title" content="Path resolver">
    <meta property="og:description" content="A module for solving paths">
    <meta property="og:type" content="article">
    <meta property="article:published_time" content="2025-09-23T00:00:00Z">
    <meta property="article:modified_time" content="2025-09-23T00:00:00Z">
    <meta property="article:section" content="Tutorial">
    </head>
  <body>
    <header>
      <div>
        <h1>YOCaml</h1>
      </div>
    </header>
    <main>
      <div>
        <div class="article-container">
  <div class="article-with-side-bar">
    
    <aside class="sidebar yo--navigation">
      
      <nav>
        <h4>Preamble</h4>
        
        
        <a href="/tutorial/index.html"
           title="A conceptual introduction to YOCaml"
           class="">
          Introduction
        </a>
        
        
        <a href="/tutorial/why.html"
           title="The promotional part of YOCaml"
           class="">
          Why use YOCaml
        </a>
        
        
        <a href="/tutorial/setup.html"
           title="Mise en place d&apos;un environnement de développement"
           class="">
          Installation and setup
        </a>
        
        
        <a href="/tutorial/key-concepts.html"
           title="Explanation of key points and concepts for building with YOCaml"
           class="">
          Key concepts
        </a>
        </nav>
      
      <nav>
        <h4>Your first blog</h4>
        
        
        <a href="/tutorial/simple-blog-goal.html"
           title="The goal and the introduction of the tutorial"
           class="">
          Goals &amp; Introduction
        </a>
        
        
        <a href="/tutorial/simple-blog-images.html"
           title="A First Action: Moving Images to the Target"
           class="">
          Moving images
        </a>
        
        
        <a href="/tutorial/simple-blog-css.html"
           title="A New Action: Generating CSS file"
           class="">
          Generating CSS
        </a>
        
        
        <a href="/tutorial/simple-blog-pages.html"
           title="Creating the first pages: written in Markdown, converted to HTML, and injected into templates"
           class="">
          Our first pages
        </a>
        
        
        <a href="/tutorial/simple-blog-server.html"
           title="Setting up a small development server to facilitate page writing"
           class="">
          A development server
        </a>
        
        
        <a href="/tutorial/simple-blog-articles.html"
           title="Creation of pages dedicated to articles"
           class="">
          Article creation
        </a>
        
        
        <a href="/tutorial/simple-blog-index.html"
           title="Creation of an index"
           class="">
          Article indexation
        </a>
        
        
        <a href="/tutorial/simple-blog-feed.html"
           title="Creating an ATOM syndication feed"
           class="">
          Creating a syndication feed
        </a>
        
        
        <a href="/tutorial/simple-blog-final.html"
           title="Conclusion on the entire tutorial"
           class="">
          Final words
        </a>
        </nav>
      
      <nav>
        <h4>Your own Data Model</h4>
        
        
        <a href="/tutorial/metadata-intro.html"
           title="Understanding how to create and validate data"
           class="">
          Introduction to Metadata
        </a>
        
        
        <a href="/tutorial/metadata-projection.html"
           title="Understanding how to create data"
           class="">
          From value to data
        </a>
        
        
        <a href="/tutorial/metadata-validation.html"
           title="Understanding how to validate data"
           class="">
          From data to values
        </a>
        
        
        <a href="/tutorial/metadata-validation-2.html"
           title="Building more accurate validators"
           class="">
          Fine-grained validators
        </a>
        
        
        <a href="/tutorial/metadata-wrapping-up.html"
           title="TBD"
           class="to-be-done">
          Readable and injectable
        </a>
        </nav>
      
      <nav>
        <h4>Specifics</h4>
        
        
        <a href="/tutorial/path.html"
           title="An explanation of how paths work"
           class="">
          Path manipulation
        </a>
        
        
        <span class="">
          Path resolver
        </span>
        
        
        <a href="/tutorial/task.html"
           title="TBD"
           class="to-be-done">
          Building and composing Task
        </a>
        </nav>
      
    </aside>
    
    <section>
      <section class="tutorial-header">
  <h1 class="main-title">Path resolver</h1>
  <section class="tutorial-info">
    <strong>Published on the</strong>
    <time datetime="2025-09-23 00:00:00">
      2025-09-23
    </time>
    
  </section>
  
  <section class="authors">
    <nav>
      <strong>Written by</strong>
      
      <a href="https://xvw.lol"
         title="xvw.lol/"
         class="author">
        <img class="avatar" alt="" src="https://www.gravatar.com/avatar/77147495ce1de81bd3b4d4044b8367fd?"/>
        <span>xvw</span>
      </a>
      
    </nav>
  </section>
  
</section>




<section class="prose">
<p>Now that we’ve seen how to manipulate paths, let’s look at a technique commonly used by YOCaml developers when writing generators: centralizing all path computations in a single module, usually called a <em>resolver</em>.</p>

</section>

<article class="prose">
<div class="hidden-toplevel">
<pre><code><span class='ocaml-keyword-other'>#</span><span class='ocaml-source'> </span><span class='ocaml-keyword-other'>#</span><span class='ocaml-source'>install_printer</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Yocaml</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>pp</span><span class='ocaml-source'> </span><span class='ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator'>;</span><span class='ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator'>;</span><span class='ocaml-source'>
</span><span class='ocaml-keyword-other'>#</span><span class='ocaml-source'> </span><span class='ocaml-keyword-other'>#</span><span class='ocaml-source'>install_printer</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Yocaml</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-constant-language-capital-identifier'>Deps</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>pp</span><span class='ocaml-source'> </span><span class='ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator'>;</span><span class='ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator'>;</span><span class='ocaml-source'>
</span><span class='ocaml-keyword-other'>#</span><span class='ocaml-source'> </span><span class='ocaml-keyword-other'>module</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Yocaml</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-source'> </span><span class='ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator'>;</span><span class='ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator'>;</span><span class='ocaml-source'>
</span><span class='ocaml-keyword-other'>module</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Yocaml</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-source'>
</span></code></pre>
</div>
<p>This guide is essentially about establishing good practices, but it
won’t teach you anything new that is specific to YOCaml.</p>
<h2 id="the-three-contexts"><a class="anchor" aria-hidden="true" href="#the-three-contexts"></a>The Three Contexts</h2>
<p>Even though in the main guide we treated paths in a fairly uniform
way, when generating a static site there are actually <strong>three
contexts</strong> for our paths:</p>
<ul>
<li>
<p><strong>The source</strong>, which lets us <em>fetch</em> the documents (or <em>assets</em>)
we’ll use to create targets.  For example: <code>./content/articles</code>,
describing the source of our articles.</p>
</li>
<li>
<p><strong>The target</strong>, which describes the paths where <em>we’ll create
artifacts</em>.  For example: <code>./_www/articles</code>, describing the
destination where we’ll generate the articles.</p>
</li>
<li>
<p><strong>The server</strong>, which describes the paths relative to the server
that serves our site.  This is useful for computing article links
(particularly for the <a href="simple-blog-index.html">index</a> and the
<a href="simple-blog-feed.html">feed</a>).  For example:
<code>/articles/my-first-article.html</code>, the URL (relative to our server)
of an article.</p>
</li>
</ul>
<p>We could imagine other contexts (like a <em>cache</em>, if we wanted to build
more ambitious caching strategies). However, for the purposes of this
guide, we’ll keep things simple.</p>
<p>While it’s possible to handle these paths in an <em>ad-hoc</em> way, as your
generator grows more complex, centralizing path calculations in a
module makes development much simpler. For example, this documentation
site uses a
<a href="https://github.com/yocaml/yocaml-www/blob/main/lib/resolver.mli"><em>resolver</em></a>.</p>
<p>In this guide, we’ll see how to create a <em>resolver</em> that can be passed
from one action to another, making our generator more modular and
helping solve potential issues cleanly.</p>
<blockquote>
<p><strong>Note</strong>: There’s no single way to write a <em>resolver</em>.  In this
article, we’ll present an approach that’s both easy to adapt to your
needs and not too intrusive.</p>
</blockquote>
<h3 id="an-annoying-problem"><a class="anchor" aria-hidden="true" href="#an-annoying-problem"></a>An Annoying Problem</h3>
<p>Beyond being a robust way to handle paths, using a <em>resolver</em> also
helps avoid a potentially frustrating issue.  In our earlier examples,
as soon as we invoked the <a href="simple-blog-server.html">development
server</a>, we assumed our site would <strong>always
be served from the root</strong>.  Indeed, even if we pass a <em>target</em>
directory to the server (so it knows which folder to serve
statically), the server itself will always start from <code>/</code>.</p>
<p>In practice, this isn’t always true. A common case is when deploying
to <em>GitHub Pages</em>, where the site root might actually be
<code>/project-name/</code>.</p>
<p>By implementing a <em>resolver</em> strategically, we can handle this issue
in an almost completely transparent way.</p>
<h2 id="resolver-for-the-simple-blog-tutorial"><a class="anchor" aria-hidden="true" href="#resolver-for-the-simple-blog-tutorial"></a>Resolver for the Simple Blog Tutorial</h2>
<p>Building on the <a href="simple-blog-goal.html">simple blog tutorial</a>, we will
now create a basic <em>resolver</em> (and briefly see how to adapt our
<em>actions</em>). To get started, in a <code>Resolver</code> module (<code>touch bin/resolver.ml</code>), we’ll define a type (which can remain abstract)
that will describe the roots of our three contexts:</p>
<pre><code><span class='ocaml-keyword-other'>type</span><span class='ocaml-source'> </span><span class='ocaml-source'>t</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> 
</span><span class='ocaml-source'>  </span><span class='ocaml-source'>{</span><span class='ocaml-source'> </span><span class='ocaml-source'>source</span><span class='ocaml-keyword-other-ocaml punctuation-other-colon punctuation'>:</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>t</span><span class='ocaml-source'>
</span><span class='ocaml-source'>  </span><span class='ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator'>;</span><span class='ocaml-source'> </span><span class='ocaml-source'>target</span><span class='ocaml-keyword-other-ocaml punctuation-other-colon punctuation'>:</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>t</span><span class='ocaml-source'>
</span><span class='ocaml-source'>  </span><span class='ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator'>;</span><span class='ocaml-source'> </span><span class='ocaml-source'>server</span><span class='ocaml-keyword-other-ocaml punctuation-other-colon punctuation'>:</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>t</span><span class='ocaml-source'>
</span><span class='ocaml-source'>  </span><span class='ocaml-source'>}</span><span class='ocaml-source'>
</span></code></pre>
<p>We can now create a function to initialize our <em>resolver</em>, allowing us
to provide default arguments:</p>
<pre><code><span class='ocaml-keyword'>let</span><span class='ocaml-source'> </span><span class='ocaml-entity-name-function-binding'>make</span><span class='ocaml-source'> 
</span><span class='ocaml-source'>  </span><span class='ocaml-variable-parameter-optional'>?</span><span class='ocaml-source'>(</span><span class='ocaml-variable-parameter-optional'>source_folder</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>rel</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-list'>[]</span><span class='ocaml-source'>)</span><span class='ocaml-source'>
</span><span class='ocaml-source'>  </span><span class='ocaml-variable-parameter-optional'>?</span><span class='ocaml-source'>(</span><span class='ocaml-variable-parameter-optional'>target_folder</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>rel</span><span class='ocaml-source'> </span><span class='ocaml-source'>[</span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-string-quoted-double'>_www</span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-source'>]</span><span class='ocaml-source'>)</span><span class='ocaml-source'>
</span><span class='ocaml-source'>  </span><span class='ocaml-variable-parameter-optional'>?</span><span class='ocaml-source'>(</span><span class='ocaml-variable-parameter-optional'>server_folder</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>abs</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-list'>[]</span><span class='ocaml-source'>)</span><span class='ocaml-source'> 
</span><span class='ocaml-source'>  </span><span class='ocaml-constant-language-unit'>()</span><span class='ocaml-source'> 
</span><span class='ocaml-source'>  </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> 
</span><span class='ocaml-source'>  </span><span class='ocaml-source'>{</span><span class='ocaml-source'> </span><span class='ocaml-source'>source</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-source'>source_folder</span><span class='ocaml-source'>
</span><span class='ocaml-source'>  </span><span class='ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator'>;</span><span class='ocaml-source'> </span><span class='ocaml-source'>target</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-source'>target_folder</span><span class='ocaml-source'>
</span><span class='ocaml-source'>  </span><span class='ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator'>;</span><span class='ocaml-source'> </span><span class='ocaml-source'>server</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-source'>server_folder</span><span class='ocaml-source'>
</span><span class='ocaml-source'>  </span><span class='ocaml-source'>}</span><span class='ocaml-source'>
</span></code></pre>
<p>The general idea is to compute all of our paths from a value of type
<code>t</code>.  We can then define functions within submodules to resolve each
path.</p>
<p>For example, if we wanted to create a resolver for a site hosted on
the <code>gh-pages</code> branch of the project <code>my-project</code>, we might imagine
the following <em>resolver</em>:</p>
<pre><code><span class='ocaml-keyword-other'>#</span><span class='ocaml-source'> </span><span class='ocaml-keyword'>let</span><span class='ocaml-source'> </span><span class='ocaml-entity-name-function-binding'>my_resolver</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> 
</span><span class='ocaml-source'>    </span><span class='ocaml-source'>make</span><span class='ocaml-source'> ~</span><span class='ocaml-source'>server_folder</span><span class='ocaml-keyword-other-ocaml punctuation-other-colon punctuation'>:</span><span class='ocaml-source'>(</span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>abs</span><span class='ocaml-source'> </span><span class='ocaml-source'>[</span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-string-quoted-double'>my-project</span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-source'>]</span><span class='ocaml-source'>)</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-unit'>()</span><span class='ocaml-source'> </span><span class='ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator'>;</span><span class='ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator'>;</span><span class='ocaml-source'>
</span><span class='ocaml-keyword-other'>val</span><span class='ocaml-source'> </span><span class='ocaml-source'>my_resolver</span><span class='ocaml-source'> </span><span class='ocaml-keyword-other-ocaml punctuation-other-colon punctuation'>:</span><span class='ocaml-source'> </span><span class='ocaml-source'>t</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-source'>{</span><span class='ocaml-source'>source</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-keyword-operator'>/</span><span class='ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator'>;</span><span class='ocaml-source'> </span><span class='ocaml-source'>target</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-keyword-operator'>/</span><span class='ocaml-source'>_www</span><span class='ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator'>;</span><span class='ocaml-source'> </span><span class='ocaml-source'>server</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>/</span><span class='ocaml-source'>my</span><span class='ocaml-keyword-operator'>-</span><span class='ocaml-source'>project</span><span class='ocaml-source'>}</span><span class='ocaml-source'>
</span></code></pre>
<h3 id="source"><a class="anchor" aria-hidden="true" href="#source"></a>Source</h3>
<p>We’ll start with the simplest submodule, <code>Source</code>.  First, we define a
function that lets us <em>easily</em> access the root of the source:</p>
<!-- $MDX skip -->
<pre><code><span class='ocaml-keyword-other'>module</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Source</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-keyword-other'>struct</span><span class='ocaml-source'> 
</span><span class='ocaml-source'>  </span><span class='ocaml-keyword'>let</span><span class='ocaml-source'> </span><span class='ocaml-entity-name-function-binding'>source_root</span><span class='ocaml-source'> </span><span class='ocaml-source'>{</span><span class='ocaml-source'> </span><span class='ocaml-source'>source</span><span class='ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator'>;</span><span class='ocaml-source'> </span><span class='ocaml-constant-language'>_</span><span class='ocaml-source'> </span><span class='ocaml-source'>}</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-source'>source</span><span class='ocaml-source'>
</span><span class='ocaml-keyword-other'>end</span><span class='ocaml-source'>
</span></code></pre>
<p>Now we can rebuild all the variables we introduced earlier in the blog
creation guide:</p>
<pre><code><span class='ocaml-keyword-other'>module</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Source</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-keyword-other'>struct</span><span class='ocaml-source'> 
</span><span class='ocaml-source'>  </span><span class='ocaml-keyword'>let</span><span class='ocaml-source'> </span><span class='ocaml-entity-name-function-binding'>source_root</span><span class='ocaml-source'> </span><span class='ocaml-source'>{</span><span class='ocaml-source'> </span><span class='ocaml-source'>source</span><span class='ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator'>;</span><span class='ocaml-source'> </span><span class='ocaml-constant-language'>_</span><span class='ocaml-source'> </span><span class='ocaml-source'>}</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-source'>source</span><span class='ocaml-source'>
</span><span class='ocaml-source'>  
</span><span class='ocaml-source'>  </span><span class='ocaml-comment-block'>(*</span><span class='ocaml-comment-block'> Assets </span><span class='ocaml-comment-block'>*)</span><span class='ocaml-source'>
</span><span class='ocaml-source'>  </span><span class='ocaml-keyword'>let</span><span class='ocaml-source'> </span><span class='ocaml-entity-name-function-binding'>assets</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>(</span><span class='ocaml-source'>source_root</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>/</span><span class='ocaml-source'> </span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-string-quoted-double'>assets</span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-source'>)</span><span class='ocaml-source'>
</span><span class='ocaml-source'>  </span><span class='ocaml-keyword'>let</span><span class='ocaml-source'> </span><span class='ocaml-entity-name-function-binding'>images</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>(</span><span class='ocaml-source'>assets</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>/</span><span class='ocaml-source'> </span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-string-quoted-double'>images</span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-source'>)</span><span class='ocaml-source'>
</span><span class='ocaml-source'>  </span><span class='ocaml-keyword'>let</span><span class='ocaml-source'> </span><span class='ocaml-entity-name-function-binding'>css</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>(</span><span class='ocaml-source'>assets</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>/</span><span class='ocaml-source'> </span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-string-quoted-double'>css</span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-source'>)</span><span class='ocaml-source'>
</span><span class='ocaml-source'>  </span><span class='ocaml-keyword'>let</span><span class='ocaml-source'> </span><span class='ocaml-entity-name-function-binding'>templates</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>(</span><span class='ocaml-source'>assets</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>/</span><span class='ocaml-source'> </span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-string-quoted-double'>templates</span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-source'>)</span><span class='ocaml-source'>
</span><span class='ocaml-source'>  
</span><span class='ocaml-source'>  </span><span class='ocaml-comment-block'>(*</span><span class='ocaml-comment-block'> Content </span><span class='ocaml-comment-block'>*)</span><span class='ocaml-source'>
</span><span class='ocaml-source'>  </span><span class='ocaml-keyword'>let</span><span class='ocaml-source'> </span><span class='ocaml-entity-name-function-binding'>content</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>(</span><span class='ocaml-source'>source_root</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>/</span><span class='ocaml-source'> </span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-string-quoted-double'>content</span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-source'>)</span><span class='ocaml-source'>
</span><span class='ocaml-source'>  </span><span class='ocaml-keyword'>let</span><span class='ocaml-source'> </span><span class='ocaml-entity-name-function-binding'>pages</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>(</span><span class='ocaml-source'>content</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>/</span><span class='ocaml-source'> </span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-string-quoted-double'>pages</span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-source'>)</span><span class='ocaml-source'>
</span><span class='ocaml-source'>  </span><span class='ocaml-keyword'>let</span><span class='ocaml-source'> </span><span class='ocaml-entity-name-function-binding'>articles</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>(</span><span class='ocaml-source'>content</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>/</span><span class='ocaml-source'> </span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-string-quoted-double'>articles</span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-source'>)</span><span class='ocaml-source'>
</span><span class='ocaml-source'>  </span><span class='ocaml-keyword'>let</span><span class='ocaml-source'> </span><span class='ocaml-entity-name-function-binding'>index</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>(</span><span class='ocaml-source'>content</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>/</span><span class='ocaml-source'> </span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-string-quoted-double'>index.md</span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-source'>)</span><span class='ocaml-source'>
</span><span class='ocaml-keyword-other'>end</span><span class='ocaml-source'>
</span></code></pre>
<p>We’ve simply relocated the variables we defined on the fly throughout
the tutorial into a <code>Resolver.Source</code> module. The main advantage is
that the source of our various files is now <strong>defined by the values we
provide to our <em>resolver</em></strong>, allowing us, for example, to condition
the source of our generator via the CLI.</p>
<h3 id="target"><a class="anchor" aria-hidden="true" href="#target"></a>Target</h3>
<p>We can perform the same exercise for the target. In the tutorial, we
calculated the target on the fly in each action. This time, we can
introduce a new submodule: <code>Resolver.Target</code>:</p>
<pre><code><span class='ocaml-keyword-other'>module</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Target</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-keyword-other'>struct</span><span class='ocaml-source'> 
</span><span class='ocaml-source'>  </span><span class='ocaml-keyword'>let</span><span class='ocaml-source'> </span><span class='ocaml-entity-name-function-binding'>target_root</span><span class='ocaml-source'> </span><span class='ocaml-source'>{</span><span class='ocaml-source'> </span><span class='ocaml-source'>target</span><span class='ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator'>;</span><span class='ocaml-source'> </span><span class='ocaml-source'>server</span><span class='ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator'>;</span><span class='ocaml-source'> </span><span class='ocaml-constant-language'>_</span><span class='ocaml-source'> </span><span class='ocaml-source'>}</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> 
</span><span class='ocaml-source'>    </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>relocate</span><span class='ocaml-source'> ~</span><span class='ocaml-source'>into</span><span class='ocaml-keyword-other-ocaml punctuation-other-colon punctuation'>:</span><span class='ocaml-source'>target</span><span class='ocaml-source'> </span><span class='ocaml-source'>server</span><span class='ocaml-source'>
</span><span class='ocaml-keyword-other'>end</span><span class='ocaml-source'>
</span></code></pre>
<p>Here there’s a subtlety! One might think that, just like the <code>Source</code>
module, the root of the target is <strong>simply</strong> the <code>target</code> member.
However, if the server root isn’t <code>/</code>, we want to build the path
relative to the server root.</p>
<p>For example, using the <em>dummy resolver</em> we created earlier (for the
project hosted on the GitHub Page <code>my-project</code>):</p>
<pre><code><span class='ocaml-keyword-other'>#</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Target</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>target_root</span><span class='ocaml-source'> </span><span class='ocaml-source'>my_resolver</span><span class='ocaml-source'> </span><span class='ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator'>;</span><span class='ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator'>;</span><span class='ocaml-source'>
</span><span class='ocaml-keyword-operator'>-</span><span class='ocaml-source'> </span><span class='ocaml-keyword-other-ocaml punctuation-other-colon punctuation'>:</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>t</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-keyword-operator'>/</span><span class='ocaml-source'>_www</span><span class='ocaml-keyword-operator'>/</span><span class='ocaml-source'>my</span><span class='ocaml-keyword-operator'>-</span><span class='ocaml-source'>project</span><span class='ocaml-source'>
</span></code></pre>
<p>This little <em>hack</em> allows us to remain consistent between the URLs on
our local server and how our site will be served in
production. Indeed, access to our site will be through
<code>localhost:port/my-project</code>.</p>
<p>We can now complete our module with the <em>ad-hoc</em> targets we previously
used in our actions.</p>
<pre><code><span class='ocaml-keyword-other'>module</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Target</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-keyword-other'>struct</span><span class='ocaml-source'> 
</span><span class='ocaml-source'>  </span><span class='ocaml-keyword'>let</span><span class='ocaml-source'> </span><span class='ocaml-entity-name-function-binding'>target_root</span><span class='ocaml-source'> </span><span class='ocaml-source'>{</span><span class='ocaml-source'> </span><span class='ocaml-source'>target</span><span class='ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator'>;</span><span class='ocaml-source'> </span><span class='ocaml-source'>server</span><span class='ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator'>;</span><span class='ocaml-source'> </span><span class='ocaml-constant-language'>_</span><span class='ocaml-source'> </span><span class='ocaml-source'>}</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> 
</span><span class='ocaml-source'>    </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>relocate</span><span class='ocaml-source'> ~</span><span class='ocaml-source'>into</span><span class='ocaml-keyword-other-ocaml punctuation-other-colon punctuation'>:</span><span class='ocaml-source'>target</span><span class='ocaml-source'> </span><span class='ocaml-source'>server</span><span class='ocaml-source'>
</span><span class='ocaml-source'>    
</span><span class='ocaml-source'>  </span><span class='ocaml-keyword'>let</span><span class='ocaml-source'> </span><span class='ocaml-entity-name-function-binding'>cache</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> 
</span><span class='ocaml-source'>    </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>(</span><span class='ocaml-source'>target_root</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>/</span><span class='ocaml-source'> </span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-string-quoted-double'>.cache</span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-source'>)</span><span class='ocaml-source'>
</span><span class='ocaml-source'>    
</span><span class='ocaml-source'>  </span><span class='ocaml-keyword'>let</span><span class='ocaml-source'> </span><span class='ocaml-entity-name-function-binding'>images</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> 
</span><span class='ocaml-source'>    </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>(</span><span class='ocaml-source'>target_root</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>/</span><span class='ocaml-source'> </span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-string-quoted-double'>images</span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-source'>)</span><span class='ocaml-source'>
</span><span class='ocaml-source'>    
</span><span class='ocaml-source'>  </span><span class='ocaml-keyword'>let</span><span class='ocaml-source'> </span><span class='ocaml-entity-name-function-binding'>style_css</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> 
</span><span class='ocaml-source'>    </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>(</span><span class='ocaml-source'>target_root</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>/</span><span class='ocaml-source'> </span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-string-quoted-double'>style.css</span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-source'>)</span><span class='ocaml-source'>
</span><span class='ocaml-source'>    
</span><span class='ocaml-source'> 
</span><span class='ocaml-source'>  </span><span class='ocaml-keyword'>let</span><span class='ocaml-source'> </span><span class='ocaml-entity-name-function-binding'>page</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-source'>source</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> 
</span><span class='ocaml-source'>    </span><span class='ocaml-keyword'>let</span><span class='ocaml-source'> </span><span class='ocaml-entity-name-function-binding'>into</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-source'>target_root</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-keyword-other'>in</span><span class='ocaml-source'>
</span><span class='ocaml-source'>    </span><span class='ocaml-source'>source</span><span class='ocaml-source'> 
</span><span class='ocaml-source'>    </span><span class='ocaml-keyword-operator'>|&gt;</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>move</span><span class='ocaml-source'> ~</span><span class='ocaml-source'>into</span><span class='ocaml-source'>
</span><span class='ocaml-source'>    </span><span class='ocaml-keyword-operator'>|&gt;</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>change_extension</span><span class='ocaml-source'> </span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-string-quoted-double'>html</span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-source'>
</span><span class='ocaml-source'>    
</span><span class='ocaml-source'>  </span><span class='ocaml-keyword'>let</span><span class='ocaml-source'> </span><span class='ocaml-entity-name-function-binding'>article</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-source'>source</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> 
</span><span class='ocaml-source'>    </span><span class='ocaml-keyword'>let</span><span class='ocaml-source'> </span><span class='ocaml-entity-name-function-binding'>into</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>(</span><span class='ocaml-source'>target_root</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>/</span><span class='ocaml-source'> </span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-string-quoted-double'>articles</span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-source'>)</span><span class='ocaml-source'> </span><span class='ocaml-keyword-other'>in</span><span class='ocaml-source'>
</span><span class='ocaml-source'>    </span><span class='ocaml-source'>source</span><span class='ocaml-source'> 
</span><span class='ocaml-source'>    </span><span class='ocaml-keyword-operator'>|&gt;</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>move</span><span class='ocaml-source'> ~</span><span class='ocaml-source'>into</span><span class='ocaml-source'>
</span><span class='ocaml-source'>    </span><span class='ocaml-keyword-operator'>|&gt;</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>change_extension</span><span class='ocaml-source'> </span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-string-quoted-double'>html</span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-source'>
</span><span class='ocaml-source'>    
</span><span class='ocaml-source'>  </span><span class='ocaml-keyword'>let</span><span class='ocaml-source'> </span><span class='ocaml-entity-name-function-binding'>index</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> 
</span><span class='ocaml-source'>    </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>(</span><span class='ocaml-source'>target_root</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>/</span><span class='ocaml-source'> </span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-string-quoted-double'>index.html</span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-source'>)</span><span class='ocaml-source'>
</span><span class='ocaml-source'>    
</span><span class='ocaml-source'>  </span><span class='ocaml-keyword'>let</span><span class='ocaml-source'> </span><span class='ocaml-entity-name-function-binding'>atom</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> 
</span><span class='ocaml-source'>    </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>(</span><span class='ocaml-source'>target_root</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>/</span><span class='ocaml-source'> </span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-string-quoted-double'>atom.xml</span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-source'>)</span><span class='ocaml-source'>
</span><span class='ocaml-keyword-other'>end</span><span class='ocaml-source'>
</span></code></pre>
<p>We can quickly verify that our <em>resolver</em> works by trying to calculate
the target for the following article:</p>
<pre><code><span class='ocaml-keyword'>let</span><span class='ocaml-source'> </span><span class='ocaml-entity-name-function-binding'>my_first_article</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> 
</span><span class='ocaml-source'>   </span><span class='ocaml-keyword'>let</span><span class='ocaml-source'> </span><span class='ocaml-keyword'>open</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-source'> </span><span class='ocaml-keyword-other'>in</span><span class='ocaml-source'>
</span><span class='ocaml-source'>   </span><span class='ocaml-constant-language-capital-identifier'>Source</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>articles</span><span class='ocaml-source'> </span><span class='ocaml-source'>my_resolver</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>/</span><span class='ocaml-source'> </span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-string-quoted-double'>my-first-article.md</span><span class='ocaml-string-quoted-double'>&quot;</span><span class='ocaml-source'>
</span></code></pre>
<p>We can use <code>Target.article</code> and see that the calculated path correctly
takes the server root into account:</p>
<pre><code><span class='ocaml-keyword-other'>#</span><span class='ocaml-source'> </span><span class='ocaml-keyword'>let</span><span class='ocaml-source'> </span><span class='ocaml-entity-name-function-binding'>my_first_article_target</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> 
</span><span class='ocaml-source'>     </span><span class='ocaml-constant-language-capital-identifier'>Target</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>article</span><span class='ocaml-source'> </span><span class='ocaml-source'>my_resolver</span><span class='ocaml-source'> </span><span class='ocaml-source'>my_first_article</span><span class='ocaml-source'> </span><span class='ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator'>;</span><span class='ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator'>;</span><span class='ocaml-source'>
</span><span class='ocaml-keyword-other'>val</span><span class='ocaml-source'> </span><span class='ocaml-source'>my_first_article_target</span><span class='ocaml-source'> </span><span class='ocaml-keyword-other-ocaml punctuation-other-colon punctuation'>:</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>t</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'>
</span><span class='ocaml-source'>  </span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-keyword-operator'>/</span><span class='ocaml-source'>_www</span><span class='ocaml-keyword-operator'>/</span><span class='ocaml-source'>my</span><span class='ocaml-keyword-operator'>-</span><span class='ocaml-source'>project</span><span class='ocaml-keyword-operator'>/</span><span class='ocaml-source'>articles</span><span class='ocaml-keyword-operator'>/</span><span class='ocaml-source'>my</span><span class='ocaml-keyword-operator'>-</span><span class='ocaml-source'>first</span><span class='ocaml-keyword-operator'>-</span><span class='ocaml-source'>article</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>html</span><span class='ocaml-source'>
</span></code></pre>
<p>We can now move on to the final step: the server.</p>
<h3 id="server"><a class="anchor" aria-hidden="true" href="#server"></a>Server</h3>
<p>Resolving links for the server is much simpler.  Indeed, we can
calculate a server path based on a standard target calculation.  We’ll
use the function
<a href="https://yocaml.github.io/doc/yocaml/yocaml/Yocaml/Path/index.html#val-trim"><code>Path.trim</code></a>,
which removes a prefix from a path:</p>
<pre><code><span class='ocaml-keyword-other'>module</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Server</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-keyword-other'>struct</span><span class='ocaml-source'> 
</span><span class='ocaml-source'>  </span><span class='ocaml-keyword'>let</span><span class='ocaml-source'> </span><span class='ocaml-entity-name-function-binding'>server_root</span><span class='ocaml-source'> </span><span class='ocaml-source'>{</span><span class='ocaml-source'> </span><span class='ocaml-source'>server</span><span class='ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator'>;</span><span class='ocaml-source'> </span><span class='ocaml-constant-language'>_</span><span class='ocaml-source'> </span><span class='ocaml-source'>}</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-source'>server</span><span class='ocaml-source'>
</span><span class='ocaml-source'>  
</span><span class='ocaml-source'>  </span><span class='ocaml-keyword'>let</span><span class='ocaml-source'> </span><span class='ocaml-entity-name-function-binding'>from_target</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-source'>path</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> 
</span><span class='ocaml-source'>    </span><span class='ocaml-keyword'>let</span><span class='ocaml-source'> </span><span class='ocaml-entity-name-function-binding'>prefix</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Target</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>target_root</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-keyword-other'>in</span><span class='ocaml-source'>
</span><span class='ocaml-source'>    </span><span class='ocaml-keyword'>let</span><span class='ocaml-source'> </span><span class='ocaml-entity-name-function-binding'>into</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-source'>server_root</span><span class='ocaml-source'> </span><span class='ocaml-source'>res</span><span class='ocaml-source'> </span><span class='ocaml-keyword-other'>in</span><span class='ocaml-source'>
</span><span class='ocaml-source'>    </span><span class='ocaml-source'>path</span><span class='ocaml-source'> 
</span><span class='ocaml-source'>    </span><span class='ocaml-keyword-operator'>|&gt;</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>trim</span><span class='ocaml-source'> ~</span><span class='ocaml-source'>prefix</span><span class='ocaml-source'> 
</span><span class='ocaml-source'>    </span><span class='ocaml-keyword-operator'>|&gt;</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>relocate</span><span class='ocaml-source'> ~</span><span class='ocaml-source'>into</span><span class='ocaml-source'>
</span><span class='ocaml-keyword-other'>end</span><span class='ocaml-source'>
</span></code></pre>
<p>We can test this using <code>my_first_article_target</code>:</p>
<pre><code><span class='ocaml-keyword-other'>#</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Server</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>from_target</span><span class='ocaml-source'> </span><span class='ocaml-source'>my_resolver</span><span class='ocaml-source'> </span><span class='ocaml-source'>my_first_article_target</span><span class='ocaml-source'> </span><span class='ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator'>;</span><span class='ocaml-keyword-other-ocaml punctuation-separator-terminator punctuation-separator'>;</span><span class='ocaml-source'>
</span><span class='ocaml-keyword-operator'>-</span><span class='ocaml-source'> </span><span class='ocaml-keyword-other-ocaml punctuation-other-colon punctuation'>:</span><span class='ocaml-source'> </span><span class='ocaml-constant-language-capital-identifier'>Path</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>t</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>=</span><span class='ocaml-source'> </span><span class='ocaml-keyword-operator'>/</span><span class='ocaml-source'>my</span><span class='ocaml-keyword-operator'>-</span><span class='ocaml-source'>project</span><span class='ocaml-keyword-operator'>/</span><span class='ocaml-source'>articles</span><span class='ocaml-keyword-operator'>/</span><span class='ocaml-source'>my</span><span class='ocaml-keyword-operator'>-</span><span class='ocaml-source'>first</span><span class='ocaml-keyword-operator'>-</span><span class='ocaml-source'>article</span><span class='ocaml-keyword-other-ocaml punctuation-other-period punctuation-separator'>.</span><span class='ocaml-source'>html</span><span class='ocaml-source'>
</span></code></pre>
<p>Now that we’ve finalized our <em>resolver</em>, we can start using it!</p>
<h2 id="using-the-resolver"><a class="anchor" aria-hidden="true" href="#using-the-resolver"></a>Using the Resolver</h2>
<p>The first thing we’ll do is initialize our resolver in our program:</p>
<blockquote>
<p>Note that it would also be possible to configure the target and
server root via CLI arguments.</p>
</blockquote>
<pre><code><span class='diff-punctuation-definition-deleted'>-</span><span class='diff-markup-deleted'> let program () =
</span><span class='diff-punctuation-definition-inserted'>+</span><span class='diff-markup-inserted'> let program resolver () =
</span><span class='diff-source'>   let open Eff in
</span><span class='diff-source'>   let cache = Path.(www / &quot;.cache&quot;) in
</span><span class='diff-source'>   Action.restore_cache cache
</span><span class='diff-source'>   &gt;&gt;= copy_images
</span><span class='diff-source'>   &gt;&gt;= create_css
</span><span class='diff-source'>   &gt;&gt;= create_pages
</span><span class='diff-source'>   &gt;&gt;= create_articles
</span><span class='diff-source'>   &gt;&gt;= create_index
</span><span class='diff-source'>   &gt;&gt;= create_feed
</span><span class='diff-source'>   &gt;&gt;= Action.store_cache cache
</span><span class='diff-source'>
</span><span class='diff-source'> let () =
</span><span class='diff-punctuation-definition-inserted'>+</span><span class='diff-markup-inserted'>  let resolver = Resolver.make () in
</span><span class='diff-source'>   match Sys.argv.(1) with
</span><span class='diff-source'>   | &quot;server&quot; -&gt; 
</span><span class='diff-source'>     Yocaml_unix.serve 
</span><span class='diff-source'>        ~level:`Info 
</span><span class='diff-source'>        ~target:www 
</span><span class='diff-source'>        ~port:8000 
</span><span class='diff-punctuation-definition-deleted'>-</span><span class='diff-markup-deleted'>       program
</span><span class='diff-punctuation-definition-inserted'>+</span><span class='diff-markup-inserted'>       (program resolver)
</span><span class='diff-source'>   | _ | (exception _) -&gt; 
</span><span class='diff-source'>      Yocaml_unix.run 
</span><span class='diff-source'>        ~level:`Debug 
</span><span class='diff-punctuation-definition-deleted'>-</span><span class='diff-markup-deleted'>       program
</span><span class='diff-punctuation-definition-inserted'>+</span><span class='diff-markup-inserted'>       (program resolver)
</span></code></pre>
<p>Next, we can pass our <em>resolver</em> to our actions. We won’t do it for
every action, because if you can do it for <strong>one action</strong>, you can do
it for all:</p>
<pre><code><span class='diff-punctuation-definition-deleted'>-</span><span class='diff-markup-deleted'>let create_css =
</span><span class='diff-punctuation-definition-inserted'>+</span><span class='diff-markup-inserted'>let create_css resolver =
</span><span class='diff-punctuation-definition-deleted'>-</span><span class='diff-markup-deleted'>  let css_path = Path.(www / &quot;style.css&quot;) in
</span><span class='diff-punctuation-definition-inserted'>+</span><span class='diff-markup-inserted'>  let css_path = Resolver.Target.style_css resolver in
</span><span class='diff-punctuation-definition-inserted'>+</span><span class='diff-markup-inserted'>  let css = Resolver.Source.css resolver in
</span><span class='diff-source'>   let pipeline =
</span><span class='diff-source'>     let open Task in
</span><span class='diff-source'>     let+ () = track_binary
</span><span class='diff-source'>     and+ content =
</span><span class='diff-source'>       Pipeline.pipe_files ~separator:&quot;\n&quot;
</span><span class='diff-source'>         Path.[ css / &quot;foo.css&quot;; css / &quot;reset.css&quot;; css / &quot;style.css&quot; ]
</span><span class='diff-source'>     in
</span><span class='diff-source'>     content
</span><span class='diff-source'>   in
</span><span class='diff-source'>   Action.Static.write_file css_path pipeline
</span><span class='diff-source'>
</span><span class='diff-source'> let program resolver () =
</span><span class='diff-source'>   let open Eff in
</span><span class='diff-punctuation-definition-deleted'>-</span><span class='diff-markup-deleted'>  let cache = Path.(www / &quot;.cache&quot;) in
</span><span class='diff-punctuation-definition-inserted'>+</span><span class='diff-markup-inserted'>  let cache = Resolver.Target.cache resolver in
</span><span class='diff-source'>   Action.restore_cache cache
</span><span class='diff-source'>   &gt;&gt;= copy_images
</span><span class='diff-punctuation-definition-deleted'>-</span><span class='diff-markup-deleted'>  &gt;&gt;= create_css
</span><span class='diff-punctuation-definition-inserted'>+</span><span class='diff-markup-inserted'>  &gt;&gt;= create_css resolver
</span><span class='diff-source'>   &gt;&gt;= create_pages
</span><span class='diff-source'>   &gt;&gt;= create_articles
</span><span class='diff-source'>   &gt;&gt;= create_index
</span><span class='diff-source'>   &gt;&gt;= create_feed
</span><span class='diff-source'>   &gt;&gt;= Action.store_cache cache
</span></code></pre>
<p>You can now update all your actions to use your freshly constructed
<em>resolver</em>!</p>
<h2 id="conclusion"><a class="anchor" aria-hidden="true" href="#conclusion"></a>Conclusion</h2>
<p>Even though this guide wasn’t particularly YOCaml-specific, we’ve seen
how to centralize path definitions! This centralization makes our
generator code more robust, potentially more configurable, and solves
the issue of sites not always being generated at a server root.</p>
<p>In practice, creating a <em>resolver</em> is a common pattern among YOCaml
users. If you have other approaches or encodings, don’t hesitate to
share them with us!</p>

</article>



      
      <div class="prev-next">
        
        <a href="/tutorial/path.html"
           title="An explanation of how paths work"
           class="previous">
          <h4>Previous</h4>
          <span class="section-title">Specifics</span>
          <span>Path manipulation</span>
        </a>
        
        
        <a href="/tutorial/task.html"
           title="TBD"
           class="next">
          <h4>Next</h4>
          <span class="section-title">Specifics</span>
          <span>Building and composing Task</span>
        </a>
        
      </div>
      
    </section>
    <aside class="toc yo--navigation">
      
      <nav id="active-toc">
        <h4>Table of content</h4>
        <ul><li><a href="#the-three-contexts" data-toc-target="the-three-contexts">The Three Contexts</a><ul><li><a href="#an-annoying-problem" data-toc-target="an-annoying-problem">An Annoying Problem</a></li></ul></li><li><a href="#resolver-for-the-simple-blog-tutorial" data-toc-target="resolver-for-the-simple-blog-tutorial">Resolver for the Simple Blog Tutorial</a><ul><li><a href="#source" data-toc-target="source">Source</a></li><li><a href="#target" data-toc-target="target">Target</a></li><li><a href="#server" data-toc-target="server">Server</a></li></ul></li><li><a href="#using-the-resolver" data-toc-target="using-the-resolver">Using the Resolver</a></li><li><a href="#conclusion" data-toc-target="conclusion">Conclusion</a></li></ul>
      </nav>
      
    </aside>
  </div>
</div>


      </div>
    </main>
    <footer>
      <div>
        <div class="yo--grid-col-autofill yo--navigation modules">
          <nav>
            <h4>Navigation</h4>
            <a href="/">Home</a>
            <a href="/tutorial">Tutorial</a>
            <a href="https://github.com/xhtmlboi/yocaml">
              YOCaml repository
            </a>
            <a href="https://github.com/yocaml/yocaml-www">
              Site repository
            </a>
            <a href="https://yocaml.github.io/doc">API Doc</a>
          </nav>
          <nav>
            <h4>Bug Trackers</h4>
            <a href="https://github.com/xhtmlboi/yocaml/issues">
              YOCaml
            </a>
            <a href="https://github.com/yocaml/yocaml-www/issues">
              Site
            </a>
            
            <a href="https://github.com/yocaml/yocaml-www/blob/main/content/tutorial/path-resolver.md">
              Page source
            </a>
            
          </nav>
          
          <nav class="inline">
            <h4>Latest releases</h4>
            
            <a href="https://github.com/xhtmlboi/yocaml/releases/tag/v2.8.0">
              v2.8.0
            </a>
            
            <a href="https://github.com/xhtmlboi/yocaml/releases/tag/v2.7.0">
              v2.7.0
            </a>
            
            <a href="https://github.com/xhtmlboi/yocaml/releases/tag/v2.6.0">
              v2.6.0
            </a>
            
            <a href="https://github.com/xhtmlboi/yocaml/releases/tag/v2.5.0">
              v2.5.0
            </a>
            
            <a href="https://github.com/xhtmlboi/yocaml/releases/tag/v2.4.1">
              v2.4.1
            </a>
            
            <a href="https://github.com/xhtmlboi/yocaml/releases/tag/v2.4.0">
              v2.4.0
            </a>
            
            <a href="https://github.com/xhtmlboi/yocaml/releases/tag/v2.3.0">
              v2.3.0
            </a>
            
            <a href="https://github.com/xhtmlboi/yocaml/releases/tag/v2.2.0">
              v2.3.0
            </a>
            
            <a href="https://github.com/xhtmlboi/yocaml/releases/tag/v2.1.0">
              v2.1.0
            </a>
            
            <a href="https://github.com/xhtmlboi/yocaml/releases/tag/v2.0.1">
              v2.0.1
            </a>
            
            <a href="https://github.com/xhtmlboi/yocaml/releases/tag/v2.0.0">
              v2.0.0
            </a>
            
            <a href="https://github.com/xhtmlboi/yocaml/releases/tag/v1.0.0">
              v1.0.0
            </a>
            
          </nav>
          
        </div>
      </div>
      <div class="yo--grid-col-autofill bottom-line">
        <div>
          <div>
            <a href="https://ocaml.org" title="OCaml website">
              <svg role="img" class="yo--icon">
                <use href="/assets/images/icons.svg#ocaml" />
              </svg>
            </a>  
          </div>
          <div>
            Proudly generated by
            <a href="https://github.com/xhtmlboi/yocaml">
              YOCaml
            </a>
          </div>
        </div>
        <div>
          <div>
            Generator under
            <a href="https://gnu.org/licenses/gpl-3.0.html">
              GPL 3.0
            </a>
            <br/>
            Content under
            <a href="https://creativecommons.org/licenses/by-sa/4.0/">
              CC BY-SA
            </a>
          </div>
          <div>
            <a href="https://creativecommons.org/licenses/by-sa/4.0/">
              <svg role="img" class="yo--icon">
                <use href="/assets/images/icons.svg#cc" />
              </svg>
            </a>
          </div>
      </div>
    </footer>
    <script src="/assets/js/frontend.bc.js"></script>
  </body>
</html>
